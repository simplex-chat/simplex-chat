<!DOCTYPE html>
<html lang="{{ page.url | getlang }}"
    {% for language in languages.languages %}
        {% if language.label == page.url | getlang %}
            dir="{{ "rtl" if language.rtl else "ltr" }}"
        {% endif %}
    {% endfor %}>

  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>
    <meta name="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="onion-location" content="{% cfg 'onionLocation' %}{{ permalink }}" />
    <meta property="og:url" content="{% cfg 'siteLocation' %}{{ permalink }}" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="{{ title }}" />
    <meta property="og:image" content="{% cfg 'siteLocation' %}/img/share_simplex.png" />
    <meta name="twitter:card" content="summary" />
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon.ico" />
    <link href="/css/tailwind.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/blog.css" />
    <link id="prism-theme" rel="stylesheet" href="/css/prism-light.min.css"/>
    <link href="/css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/design3-nav.css">
    <script src="/js/ethers.umd.min.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
</head>

  <body class="bg-[#F3F6F7] dark:bg-[#0C0B13]">
    {% include "navbar.html" %}

    <section id="article" class="container mb-[75px] bg-white dark:bg-[#17203D] px-5 mt-[66px]">
      <div class="py-6 md:p-[60px]">{{ content | safe }}</div>
    </section>

    <div id="mint-simplex-nft" class="overlay hidden fixed top-0 left-0 bottom-0 right-0 before:absolute before:w-full before:h-full bg-transparent before:bg-secondary-bg-light dark:before:bg-primary-bg-dark before:opacity-90 items-center justify-center p-3 md:p-10 z-[10000]">
        <div class="overlay-card w-full md:w-fit md:max-w-[1276px] bg-white dark:bg-card-bg-dark opacity-100 h-full md:h-fit md:max-h-[660px] z-[10001] rounded-md shadow-[0px_3px_12px_rgba(0,0,0,0.2)] p-6 py-10 sm:p-14 overflow-auto scale-100">
            <div>
                <button id="connectButton">Connect Wallet</button>
                <p id="account"></p>
                <button id="readButton">Read Mint until time</button>
                <p id="readResult"></p>
                <input id="inputValue" type="text" placeholder="Enter address">
                <button id="writeButton">Mint token to you</button>
                <p id="writeResult"></p>
            </div>

            <script>
                // Replace these with your actual contract details
                const nftAddress = '';
                const nftABI = [
                    // Minimal ABI example: assume a contract with getValue() and setValue(uint256)
                    'function name() view returns (string)',
                    'function mint(address)'
                ];

                const minterAddress = '';
                const minterABI = [
                    'function mintEndTime() view returns (uint)',
                    'function mint(uint)',
                ]

                let provider;
                let signer;
                let nftContract;
                let minterContract;

                // Connect wallet (MetaMask)
                document.getElementById('connectButton').onclick = async () => {
                    if (typeof window.ethereum !== 'undefined') {
                        try {
                            provider = new ethers.BrowserProvider(window.ethereum);
                            const accounts = await provider.send('eth_requestAccounts', []);
                            signer = await provider.getSigner();
                            nftContract = new ethers.Contract(nftAddress, nftABI, signer);
                            minterContract = new ethers.Contract(minterAddress, minterABI, signer);
                            console.log(accounts);
                            document.getElementById('account').textContent = `Connected: ${accounts[0]}`;
                        } catch (error) {
                            console.error('Connection failed:', error);
                            document.getElementById('account').textContent = 'Connection failed';
                        }
                    } else {
                        alert('Install MetaMask!');
                    }
                };

                // Read from contract (no gas/tx needed)
                document.getElementById('readButton').onclick = async () => {
                    if (!nftContract || !minterContract) return alert('Connect wallet first');
                    try {
                        const value = await minterContract.mintEndTime();
                        document.getElementById('readResult').textContent = `Value: ${value.toString()}`;
                    } catch (error) {
                        alert(`Read failed: ${error}`);
                        console.error('Read failed:', error);
                    }
                };

                // Write to contract (requires signing and gas)
                document.getElementById('writeButton').onclick = async () => {
                    if (!nftContract) return alert('Connect wallet first');
                    const input = document.getElementById('inputValue').value;
                    if (!input) return alert('Enter a value');
                    try {
                        const tx = await minterContract.mint(input);
                        await tx.wait(); // Wait for confirmation
                        document.getElementById('writeResult').textContent = `Tx successful: ${tx.hash}`;
                    } catch (error) {
                        alert(`Write failed: ${error.reason}`);
                        console.error('Write failed:', error);
                    }
                };
            </script>

            <svg class="close-overlay-btn" id="cross" width="16" height="16" viewBox="0 0 13 13" xmlns="http://www.w3.org/2000/svg">
                <path d="M12.7973 11.5525L7.59762 6.49833L12.7947 1.44675C13.055 1.19371 13.0658 0.771991 12.8188 0.505331C12.5718 0.238674 12.1602 0.227644 11.8999 0.480681L6.65343 5.58028L1.09979 0.182228C0.839522 -0.070157 0.427909 -0.059127 0.18094 0.207531C-0.0660305 0.474191 -0.0552645 0.895911 0.205003 1.14894L5.70862 6.49833L0.20247 11.851C-0.0577975 12.104 -0.0685635 12.5257 0.178407 12.7924C0.306324 12.9306 0.477936 13 0.650181 13C0.811033 13 0.971873 12.9397 1.09726 12.817L6.65343 7.41639L11.9025 12.5186C12.0285 12.6406 12.1893 12.7015 12.3495 12.7015C12.5218 12.7015 12.6934 12.6321 12.8213 12.4939C13.0689 12.2273 13.0582 11.8062 12.7973 11.5525Z"/>
            </svg>
        </div>
    </div>

    {% include "footer.html" %}
    <script src="/js/prism.min.js"></script>
    <script src="/js/swiper-bundle.min.js"></script>
    <script src="/js/script.js"></script>
</body>

</html>
